phpstan:
  stage: Static Analysis
  image: ${BASE_IMAGE}
  needs:
    - composer
  script:
    - php -d memory_limit=-1 vendor/bin/phpstan analyse $(pwd)/src --level 8
  except:
    - tags

psalm:
  stage: Static Analysis
  image: ${BASE_IMAGE}
  needs:
    - composer
  script:
    - vendor/bin/psalm
  except:
    - tags

infection:
  stage: Static Analysis
  image: ${BASE_IMAGE}
  dependencies:
    - composer
    - unit-tests
  needs:
    - composer
    - unit-tests
  script:
    - phpdbg -qrr vendor/bin/infection --min-covered-msi=79 --only-covered --threads=6 --coverage=report/raw/phpunit/coverage --test-framework-options="--testsuite=UnitTests "
  artifacts:
    expire_in: 1 day
    paths:
      - report/
  except:
    - tags
