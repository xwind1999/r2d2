stages:
  - API Spec Validation
  - Publish API reference

validate-api-spec-schema:
  stage: API Spec Validation
  image:
    name: docker-registry.production.smartbox.com/millenniumfalcon/bb-8-api-swagger-cli
    entrypoint: [""]
  script:
    - swagger-cli validate reference/r2d2-api/openapi.yaml
  tags:
    - k8s

pages:
  stage: Publish API reference
  script:
    - rm -rf public/
    - mkdir -p public/reference/
    - mkdir -p public/docs/
    - cp -R reference/* public/reference/
    - cp -R docs/* public/docs/
    - cp docs/html/openapi.html public/reference/r2d2-api/
  artifacts:
    paths:
      - public
    expire_in: 7 days
  tags:
    - k8s
